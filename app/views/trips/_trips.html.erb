<table>
<table class="table table-striped">
  <thead>
    <th>Дата</th>
    <th>Клиент</th>
    <th>Длина маршрута</th>
    <th>Стоимость</th>
    <th>Потрачено бонусов</th>
    <th></th>
  </thead>
  <tbody>
    <% @orders.each do |order| %>
        <% if order.natural_person.present? %>
        <tr>
          <td><%= order.datetime_from %></td>
          <td>
            <% unless order.natural_person.nil? %>
              <% if order.natural_person.client.nil? %>
                <%= link_to "#{order.natural_person.full_name.force_encoding("cp1251").encode("utf-8", undef: :replace)}", new_client_path(natural_person: order.natural_person.id) %>
              <% else %>
                <%= link_to  order.natural_person.client.to_s.encode,  order.natural_person.client %>
              <% end %>
            <% end %>
          </td>
          <td><%= order.route_length %></td>
          <td><%= order.cost_plan %></td>
          <td><%= order.trip.try(:bonus_point) %></td>
          <td>
            <% if can? :manage, @client and order.trip.try(:bonus_point).nil?%>
              <% unless order.natural_person.nil? or order.natural_person.client.nil? %>
                <%= link_to "Оплатить бонусами", new_trip_path(client: @client, order_id: order) %>
              <% else %>
                  <%= link_to "Пригласить в бонусную программу", new_client_path(natural_person: order.natural_person)  %>
              <% end %>
            <% end %>
          </td>
        </tr>
        <% end %>
    <% end %>
  </tbody>
</table>
